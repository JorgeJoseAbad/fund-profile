<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<!-- <link rel="import" href="../components/posicion-global-chart.html">-->
<link rel="import" href="../components/my-highcharts-stock.html">
<link rel="import" href="../../../bower_components/vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="../theme/shared-styles.html">

<dom-module id="evolucion-tab">
    <template>
        <style include="shared-styles">
            :host {
                display: block
            }
        </style>

        
    <div class="header-tab">
        <h2>Evolución</h2>
    </div> 

    <p>Período consultado: [[startDateInterval]] to [[endDateInterval]]</p>
    <p>Última actualización:</p>

   <!--pongo directamente my-highcharts-stock-->
    <my-highcharts-stock 
        title='[[name]]' 
        subtitle='Valor Liquidativo' 
        series='[[series]]'>
    </my-highcharts-stock>

    <!--Deberia retirar esta posicion-golbalchart 
    <posicion-global-chart values="[[values]]" name="[[name]]" ></posicion-global-chart>
    -->

    <vaadin-date-picker
        label="DateStart" placeholder="Pick a date" value="{{startDateInterval}}">
    </vaadin-date-picker>

    <vaadin-date-picker
        label="DateEnd" placeholder="Pick a date" value="{{endDateInterval}}">
    </vaadin-date-picker>

    <button>
        <iron-icon on-click="updateData" class="lupa" icon="icons:search"></iron-icon>
    </button>

    <div class="header-tab">
            <h2>Datos a <b>[[endDateInterval]]</b></h2>
    </div> 


    <div class="header-tab">
            <h2>Datos Estadisticos</h2>
    </div> 


    </template>

    <script>
        /**
         * `evolucion-tab` Description
         *
         * @summary ShortDescription.
         * @customElement
         * @polymer
         * @extends {Polymer.Element}
         */
        class EvolucionTab extends Polymer.Element {
            /**
             * String providing the tag name to register the element under.
             */
            static get is() {
                return 'evolucion-tab';
            }

            /**
             * Object describing property-related metadata used by Polymer features
             */
            static get properties() {
                return {
                    values:{
                        type: Array,
                        value: function(){
                            return []
                        }
                    },
                    /** 
                    *Array with Object that have nave and data, data is a array of array(2)
                    */
                    series:{
                        type: Array,
                        value:function(){
                            return []
                        }
                    },
                   
                    name: {
                        type: String,
                        value:""
                    },

                    startDateInterval:{
                        type: String,
                        value:"",
                        observer: "_startdate"
                    },

                    endDateInterval:{
                        type: String,
                        value:"",
                        observer:"_enddate"
                    },

                    filteredValues:{
                        type: Array,
                        value: function(){
                            return []
                        }
                    }

                };
            }

            /**
              * Array of strings describing multi-property observer methods and their
              * dependant properties
              */
            static get observers() {
                return [
                    'Changed(values,name)',

                ];
            }

            Changed(values,name){
                console.log("values: ",values)
                console.log("Name: ",name)
            }

            _startdate(){
              
                if (this.startDateInterval!=="") {
                    this.filterValues(this.startDateInterval,this.endDateInterval,this.values);
                }
            }
            _enddate(){
             
               if (this.endDateInterval!=="") {
                this.filterValues(this.startDateInterval,this.endDateInterval,this.values);
           
               } }


            filterValues(startDate,endDate,values){
 
                let localFilteredValues=[];
                let startTimestamp=Date.parse(startDate)
                let endTimestamp=Date.parse(endDate)
 
                localFilteredValues=values.filter(
                    element => 
                        ((element.date>=startTimestamp)&&(element.date<=endTimestamp))
                    );

                this.set("filteredValues",localFilteredValues)
            }


            updateData(){
                //filteredValues is a array of objects, HighCharts needs an array with
                // a object that have a name and an array of arrays(2) for the data, so:
                const arrayTwoData = this.filteredValues.map(item => [item.date, item.netAssetValue])
                this.set('series', [{ name: this.name, data: arrayTwoData }])

            }



            /**
             * Instance of the element is created/upgraded. Use: initializing state,
             * set up event listeners, create shadow dom.
             * @constructor
             */
            constructor() {
                super();
            }
        }

        window.customElements.define(EvolucionTab.is, EvolucionTab);
    </script>
</dom-module>